# Port probing und scanning

**Name**: Jan Freitag   
**Klasse**: 4AHITS   
**Fach**: ITSE   
**Datum**: 03.11.2025   
**Anweisungen**: [Port probing und scanning](https://www.franzmatejka.at/htl/doc/ITSI_4/lab/04_portscan.html)

## Übungen

### host discovery

Ein Ping-Scan (Host-Discovery) mit nmap ermittelt, welche IP-Adressen in einem Netzwerk erreichbar sind, ohne Ports zu prüfen — nmap verwendet dazu ICMP-Echo, TCP/UDP-Pings und auf lokalen Netzen ARP-Requests. Typisches Kommando: `nmap -sn 192.168.1.0/24` (früher `-sP`); mit `-Pn` überspringt man die Discovery, und scanne nur Netze, für die du eine Erlaubnis hast.

```shell
nmap -sn <ip>/<subnet>
```

### port probing

#### ssh

##### telnet

```shell
187hahaxd@MacBook ~ % telnet 172.20.10.2 22
Trying 172.20.10.2...
Connected to 172.20.10.2.
Escape character is '^]'.
SSH-2.0-OpenSSH_4.7p1 Debian-8ubuntu1
```

#### webserver

##### telnet

```shell
187hahaxd@MacBook  % telnet 172.20.10.2 80
Trying 172.20.10.2...
Connected to 172.20.10.2.
Escape character is '^]'.
HEAD / HTTP/1.0

HTTP/1.1 200 OK
Date: Mon, 03 Nov 2025 11:21:34 GMT
Server: Apache/2.2.8 (Ubuntu) DAV/2
X-Powered-By: PHP/5.2.4-2ubuntu5.10
Connection: close
Content-Type: text/html

Connection closed by foreign host.
```

##### nc

```shell
Connection to 172.20.10.2 port 80 [tcp/http] succeeded!
HEAD / HTTP/1.0

HTTP/1.1 200 OK
Date: Mon, 03 Nov 2025 11:28:19 GMT
Server: Apache/2.2.8 (Ubuntu) DAV/2
X-Powered-By: PHP/5.2.4-2ubuntu5.10
Connection: close
Content-Type: text/html
```

##### curl

```shell
187hahaxd@MacBook ~ % curl --head 172.20.10.2
HTTP/1.1 200 OK
Date: Mon, 03 Nov 2025 11:26:00 GMT
Server: Apache/2.2.8 (Ubuntu) DAV/2
X-Powered-By: PHP/5.2.4-2ubuntu5.10
Content-Type: text/html
```

#### port probing cheat sheet

##### nc (netcat)

- Verbindung / Banner-Grab (TCP):
  `nc example.com 22` — verbindet interaktiv; Ctrl+C/EOF zum Beenden.
- Port-Probe (nur prüfen, ob offen):
  `nc -vz example.com 22` — `-z` = scan (no I/O), `-v` = verbose.
- Mehrere Ports / UDP:
  `nc -vz example.com 20-25` oder `nc -uzv example.com 53` (`-u` für UDP).
- Timeout setzen:
  `nc -w 3 -vz example.com 80` (`-w` in Sekunden).

##### curl

- HTTP-Header check (schnell):
  `curl -I http://example.com:8080` — holt nur Response-Header (Status, Server, …).
- Volle Anfrage + Debug (verbindungsdetails):
  `curl -v http://example.com:8080/` — zeigt TCP-Handshake, TLS und HTTP-Exchange.
- Einfacher TCP/Telnet-Connect (raw-Probe):
  `curl --connect-timeout 5 telnet://example.com:23` — prüft TCP-Verbindung zum Port.
- Zeitlimit / stille Prüfung:
  `curl -sS --max-time 5 -o /dev/null -w "%{http_code}\n" http://example.com:8080` — gibt HTTP-Status zurück.

##### telnet

- Einfache Port-Verbindung:
  `telnet example.com 25` — verbindet; bei Erfolg erhältst du Prompt oder Banner, bei Fehler „Connection refused/failed“.
- Steuerung / beenden:
  `Ctrl+]` → `quit` oder `Ctrl+]` → `close`.
- Tipp für Banner-Grabbing: nach Verbindungsaufbau oft einfach Enter drücken, um Serverbanner zu sehen.

### netcat port scan

```shell
187hahaxd@MacBook ~ % nc -z 172.20.10.2 1-30
Connection to 172.20.10.2 port 21 [tcp/ftp] succeeded!
Connection to 172.20.10.2 port 22 [tcp/ssh] succeeded!
Connection to 172.20.10.2 port 23 [tcp/telnet] succeeded!
Connection to 172.20.10.2 port 25 [tcp/smtp] succeeded!
```

`-z` ... nur Verbindung, keine Datenübertragung

### nmap port scan

#### Normaler Scan

```shell
187hahaxd@MacBook ~ % nmap 172.20.10.2 
Starting Nmap 7.98 ( https://nmap.org ) at 2025-11-03 12:38 +0100
Nmap scan report for 172.20.10.2
Host is up (0.0020s latency).
Not shown: 976 filtered tcp ports (no-response)
PORT     STATE  SERVICE
21/tcp   open   ftp
22/tcp   open   ssh
23/tcp   open   telnet
25/tcp   open   smtp
53/tcp   open   domain
80/tcp   open   http
111/tcp  open   rpcbind
139/tcp  open   netbios-ssn
445/tcp  open   microsoft-ds
512/tcp  open   exec
513/tcp  open   login
514/tcp  open   shell
1099/tcp open   rmiregistry
1524/tcp open   ingreslock
2049/tcp open   nfs
2121/tcp open   ccproxy-ftp
3306/tcp open   mysql
5432/tcp open   postgresql
5900/tcp open   vnc
6000/tcp open   X11
6667/tcp open   irc
8009/tcp open   ajp13
8180/tcp open   unknown
8888/tcp closed sun-answerbook

Nmap done: 1 IP address (1 host up) scanned in 52.55 seconds
```

#### Alle Ports

```shell
187hahaxd@MacBook ~ % sudo nmap -T5 -n -sS --min-rate 10000 --max-retries 1 -p- 172.20.10.2
Password:
Starting Nmap 7.98 ( https://nmap.org ) at 2025-11-03 12:57 +0100
Nmap scan report for 172.20.10.2
Host is up (0.00017s latency).
Not shown: 65505 closed tcp ports (reset)
PORT      STATE SERVICE
21/tcp    open  ftp
22/tcp    open  ssh
23/tcp    open  telnet
25/tcp    open  smtp
53/tcp    open  domain
80/tcp    open  http
111/tcp   open  rpcbind
139/tcp   open  netbios-ssn
445/tcp   open  microsoft-ds
512/tcp   open  exec
513/tcp   open  login
514/tcp   open  shell
1099/tcp  open  rmiregistry
1524/tcp  open  ingreslock
2049/tcp  open  nfs
2121/tcp  open  ccproxy-ftp
3306/tcp  open  mysql
3632/tcp  open  distccd
5432/tcp  open  postgresql
5900/tcp  open  vnc
6000/tcp  open  X11
6667/tcp  open  irc
6697/tcp  open  ircs-u
8009/tcp  open  ajp13
8180/tcp  open  unknown
8787/tcp  open  msgsrvr
48438/tcp open  unknown
52851/tcp open  unknown
53758/tcp open  unknown
53866/tcp open  unknown
MAC Address: 52:54:00:12:34:56 (QEMU virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 7.20 seconds
```

Ja es macht einen Unterschied, da mehr Ports gelistet werden (z.B. 3632)

#### Überspringen Ping-Scan/Host-Discovery.

```shell
nmap -Pn <ip>
```

Überspringt die Überprüfung, ob es den Host gibt / online ist

#### Service/Version Detection

```shell
nmap -sV <ip>
```

#### OS Erkennung

```shell
nmap -O <ip>
```

#### Aggressive Scan

```shell
nmap -A <ip>
```

#### Timing/Speed

```shell
nmap -T<1-5> <ip>
```

`-T0` ... Paranoid (sehr langsam)
`-T1` ... Sneaky
`-T3` ... Normal (Standard)
`-T4` ... # Aggressive
`-T5` ... # Insane

#### Ausgabe in Dateien

```shell
nmap -o<N, X, G, A> <ip>
```

`-oN` ... Normal

`-oX` ... XML

`-oG` ... Grep-freundlich

`-oA` ... Alle Formate

#### die Option `--reason`

```shell
nmap --reason <ip>
```

Zeigt an, warum der Port offen / geschlossen ist

#### nur die N häufigsten Ports scannen (dokumentiere den Geschwindigkeitsgewinn)

```shell
nmap --top-ports <amount> <ip>
```

##### Vergleich

###### Normal

```shell
187hahaxd@MacBook ~ % nmap -T5 172.20.10.2
[...]
Nmap done: 1 IP address (1 host up) scanned in 31.96 seconds
```

###### Top 100 Ports

```shell
nmap -T5 --top-ports 100 172.20.10.2
[...]
Nmap done: 1 IP address (1 host up) scanned in 11.25 seconds
```

#### Andere Systeme

###### Kali

```shell
187hahaxd@MacBook ~ % nmap -T5 -Pn --top-ports 100 172.20.10.4
Starting Nmap 7.98 ( https://nmap.org ) at 2025-11-03 13:17 +0100
Nmap scan report for 172.20.10.4
Host is up (0.00096s latency).
Not shown: 99 filtered tcp ports (no-response)
PORT   STATE SERVICE
22/tcp open  ssh

Nmap done: 1 IP address (1 host up) scanned in 3.71 seconds
```

###### 

